<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>المصداقية لتأجير الوحدات السكنية - صلالة، عمان</title>
<meta name="description" content="موقع المصداقية لتأجير الوحدات السكنية في صلالة - أفضل الأسعار وأجود الخدمات لتأجير الشقق والغرف والفلل">
<meta name="keywords" content="تأجير، وحدات سكنية، صلالة، عمان، شقق، غرف، فلل، المصداقية">
<meta name="author" content="المصداقية لتأجير الوحدات السكنية">

<!-- Open Graph / Facebook -->
<meta property="og:type" content="website">
<meta property="og:url" content="https://almesdaqiah-website.netlify.app/">
<meta property="og:title" content="المصداقية لتأجير الوحدات السكنية">
<meta property="og:description" content="أفضل الوحدات السكنية للإيجار في صلالة، عمان">
<meta property="og:image" content="https://almesdaqiah-website.netlify.app/preview.jpg">

<!-- Twitter -->
<meta property="twitter:card" content="summary_large_image">
<meta property="twitter:url" content="https://almesdaqiah-website.netlify.app/">
<meta property="twitter:title" content="المصداقية لتأجير الوحدات السكنية">
<meta property="twitter:description" content="أفضل الوحدات السكنية للإيجار في صلالة، عمان">

<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.css">
<script src="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.js"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@200;300;400;500;600;700;800&display=swap" rel="stylesheet">

<!-- Favicon -->
<link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🏠</text></svg>">

<script>
tailwind.config = {
theme: {
extend: {
fontFamily: {
'cairo': ['Cairo', 'sans-serif'],
},
colors: {
'oman-blue': '#003f7f',
'oman-light': '#4a90e2',
'accent': '#22c55e',
'warning': '#f59e0b',
}
}
}
}
</script>
<style>
* {
font-family: 'Cairo', sans-serif;
}

.neumorphic {
background: #f7fafc;
box-shadow: 20px 20px 60px #d1d9e6, -20px -20px 60px #ffffff;
}

.dark .neumorphic {
background: #2d3748;
box-shadow: 20px 20px 60px #1a202c, -20px -20px 60px #4a5568;
}

.swiper-pagination-bullet {
background: #4a90e2;
}

.available-day {
background: linear-gradient(45deg, #22c55e, #16a34a);
color: white;
}

.booked-day {
background: linear-gradient(45deg, #ef4444, #dc2626);
color: white;
}

.selected-day {
background: linear-gradient(45deg, #4a90e2, #3b82f6);
color: white;
border: 2px solid #1d4ed8;
}

.fade-in {
animation: fadeIn 0.5s ease-in;
}

@keyframes fadeIn {
from { opacity: 0; transform: translateY(20px); }
to { opacity: 1; transform: translateY(0); }
}

@keyframes fadeOut {
from { opacity: 1; transform: translateY(0); }
to { opacity: 0; transform: translateY(-20px); }
}

/* إصلاح مشكلة التمرير في النوافذ المنبثقة */
.modal-container {
overflow-y: auto;
max-height: 100vh;
padding: 1rem;
}

.modal-content {
max-height: calc(100vh - 2rem);
overflow-y: auto;
}

/* إصلاح مشكلة ألوان النصوص */
.text-adaptive {
color: #374151;
}

.dark .text-adaptive {
color: #f3f4f6;
}

.text-adaptive-secondary {
color: #6b7280;
}

.dark .text-adaptive-secondary {
color: #d1d5db;
}

/* جدول التقويم المنزلق */
.calendar-slider {
max-height: 400px;
overflow-y: auto;
border: 2px solid #e5e7eb;
border-radius: 12px;
background: #f9fafb;
}

.dark .calendar-slider {
border-color: #374151;
background: #1f2937;
}

.calendar-day-row {
min-height: 50px;
transition: all 0.3s ease;
}

.calendar-day-row:hover {
background-color: #f3f4f6;
}

.dark .calendar-day-row:hover {
background-color: #374151;
}

/* معاينة الصور */
.image-preview {
position: relative;
display: inline-block;
margin: 8px;
}

.image-preview img {
width: 120px;
height: 120px;
object-fit: cover;
border-radius: 12px;
border: 3px solid #e5e7eb;
transition: all 0.3s ease;
}

.image-preview:hover img {
border-color: #4a90e2;
}

.remove-image-btn {
position: absolute;
top: -10px;
right: -10px;
background: #ef4444;
color: white;
border-radius: 50%;
width: 28px;
height: 28px;
display: flex;
align-items: center;
justify-content: center;
cursor: pointer;
font-size: 16px;
font-weight: bold;
box-shadow: 0 2px 8px rgba(0,0,0,0.3);
}

.remove-image-btn:hover {
background: #dc2626;
}

/* تحسين شكل رفع الملفات */
.file-upload-area {
border: 3px dashed #d1d5db;
border-radius: 12px;
padding: 40px;
text-align: center;
transition: all 0.3s ease;
cursor: pointer;
}

.file-upload-area:hover {
border-color: #4a90e2;
background-color: #f8fafc;
}

.dark .file-upload-area {
border-color: #4b5563;
background-color: #1f2937;
}

.dark .file-upload-area:hover {
border-color: #4a90e2;
background-color: #374151;
}

/* مؤشر حالة التزامن */
.sync-indicator {
position: fixed;
top: 20px;
left: 20px;
z-index: 1000;
display: none;
align-items: center;
gap: 8px;
padding: 8px 12px;
border-radius: 20px;
font-size: 12px;
font-weight: 500;
transition: all 0.3s ease;
}

.sync-online {
background: #10b981;
color: white;
}

.sync-offline {
background: #ef4444;
color: white;
}

.sync-syncing {
background: #f59e0b;
color: white;
}

.pulse-dot {
width: 8px;
height: 8px;
border-radius: 50%;
background: currentColor;
animation: pulse 1.5s infinite;
}

@keyframes pulse {
0%, 100% { opacity: 1; }
50% { opacity: 0.5; }
}

/* تحسينات إضافية للمظهر */
.hero-gradient {
background: linear-gradient(135deg, #003f7f 0%, #4a90e2 100%);
}

.loading-skeleton {
background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
background-size: 200% 100%;
animation: loading 1.5s infinite;
}

@keyframes loading {
0% { background-position: 200% 0; }
100% { background-position: -200% 0; }
}
</style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 transition-all duration-300">
<!-- مؤشر حالة التزامن (مخفي للمستخدمين العاديين) -->
<div id="syncIndicator" class="sync-indicator sync-offline">
<div class="pulse-dot"></div>
<span id="syncStatus">غير متصل</span>
</div>

<!-- Header -->
<header class="bg-white dark:bg-gray-800 shadow-lg transition-all duration-300 sticky top-0 z-30">
<div class="container mx-auto px-4 py-4">
<div class="flex justify-between items-center">
<div class="flex items-center space-x-4 space-x-reverse">
<div class="w-12 h-12 bg-gradient-to-br from-oman-blue to-oman-light rounded-lg flex items-center justify-center">
<span class="text-white font-bold text-xl">م</span>
</div>
<div>
<h1 class="text-2xl font-bold text-oman-blue dark:text-oman-light">المصداقية</h1>
<p class="text-sm text-adaptive-secondary">لتأجير الوحدات السكنية</p>
</div>
</div>

<div class="flex items-center space-x-4 space-x-reverse">
<button onclick="toggleDarkMode()" class="p-2 rounded-lg bg-gray-100 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 transition-all duration-300">
<span id="theme-icon" class="text-xl">🌙</span>
</button>
<button onclick="showAdminLogin()" class="px-4 py-2 bg-oman-blue hover:bg-oman-light text-white rounded-lg transition-all duration-300">
لوحة الإدارة
</button>
</div>
</div>
</div>
</header>

<!-- Hero Section -->
<section class="hero-gradient text-white py-16">
<div class="container mx-auto px-4 text-center">
<h2 class="text-4xl md:text-5xl font-bold mb-4">مرحباً بكم في المصداقية</h2>
<p class="text-xl md:text-2xl mb-8 text-blue-100">أفضل الوحدات السكنية للإيجار في صلالة</p>
<div class="flex flex-wrap justify-center gap-4 text-sm md:text-base">
<div class="flex items-center space-x-2 space-x-reverse bg-white bg-opacity-20 px-4 py-2 rounded-full">
<span>🏠</span>
<span>أكثر من 50 وحدة</span>
</div>
<div class="flex items-center space-x-2 space-x-reverse bg-white bg-opacity-20 px-4 py-2 rounded-full">
<span>⭐</span>
<span>خدمة 5 نجوم</span>
</div>
<div class="flex items-center space-x-2 space-x-reverse bg-white bg-opacity-20 px-4 py-2 rounded-full">
<span>📱</span>
<span>حجز فوري</span>
</div>
</div>
</div>
</section>

<!-- Main Content -->
<main id="main-content" class="container mx-auto px-4 py-8">
<!-- Filters Section -->
<div class="neumorphic rounded-2xl p-6 mb-8 fade-in">
<h2 class="text-xl font-bold text-adaptive mb-4">البحث والفلترة</h2>
<div class="grid grid-cols-1 md:grid-cols-4 gap-4">
<div>
<label class="block text-sm font-medium text-adaptive-secondary mb-2">النوع</label>
<select id="typeFilter" class="w-full p-3 border rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 text-adaptive text-base">
<option value="">جميع الأنواع</option>
<option value="شقة">شقق</option>
<option value="غرفة">غرف</option>
<option value="فيلا">فلل</option>
<option value="بيت">بيوت</option>
</select>
</div>

<div>
<label class="block text-sm font-medium text-adaptive-secondary mb-2">السعر (ريال عماني)</label>
<select id="priceFilter" class="w-full p-3 border rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 text-adaptive text-base">
<option value="">جميع الأسعار</option>
<option value="0-30">أقل من 30</option>
<option value="30-60">30 - 60</option>
<option value="60-90">60 - 90</option>
<option value="90+">90 وأكثر</option>
</select>
</div>

<div>
<label class="block text-sm font-medium text-adaptive-secondary mb-2">الموقع</label>
<select id="locationFilter" class="w-full p-3 border rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 text-adaptive text-base">
<option value="">جميع المواقع</option>
<option value="صلالة الجديدة">صلالة الجديدة</option>
<option value="صلالة الوسطى">صلالة الوسطى</option>
<option value="صلالة الغربية">صلالة الغربية</option>
<option value="عوقد">عوقد</option>
<option value="السعادة">السعادة</option>
<option value="صحنوت">صحنوت</option>
<option value="ريسوت">ريسوت</option>
</select>
</div>

<div>
<label class="block text-sm font-medium text-adaptive-secondary mb-2">البحث</label>
<input id="searchInput" type="text" placeholder="اسم الوحدة أو الوصف..." class="w-full p-3 border rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 text-adaptive text-base">
</div>
</div>
</div>

<!-- Units Grid -->
<div id="unitsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
<!-- Units will be loaded here -->
</div>

<!-- Loading Spinner -->
<div id="loadingSpinner" class="fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50">
<div class="bg-white dark:bg-gray-800 rounded-lg p-6 flex items-center space-x-4 space-x-reverse">
<div class="animate-spin rounded-full h-8 w-8 border-b-2 border-oman-blue"></div>
<span class="text-adaptive font-medium">جاري تحميل البيانات من GitHub...</span>
</div>
</div>
</main>

<!-- Admin Panel -->
<div id="adminPanel" class="hidden fixed inset-0 z-50 bg-gray-900 bg-opacity-75">
<div class="modal-container flex items-center justify-center">
<div class="modal-content bg-white dark:bg-gray-800 rounded-2xl shadow-2xl w-full max-w-6xl">
<!-- Admin content will be loaded here -->
</div>
</div>
</div>

<!-- Unit Details Modal -->
<div id="unitModal" class="hidden fixed inset-0 z-40 bg-gray-900 bg-opacity-75">
<div class="modal-container flex items-center justify-center">
<div class="modal-content bg-white dark:bg-gray-800 rounded-2xl shadow-2xl w-full max-w-4xl">
<!-- Unit details will be loaded here -->
</div>
</div>
</div>

<!-- Contact Modal -->
<div id="contactModal" class="hidden fixed inset-0 z-40 bg-gray-900 bg-opacity-75">
<div class="modal-container flex items-center justify-center">
<div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl w-full max-w-md mx-4">
<div class="p-6">
<div class="flex justify-between items-center mb-4">
<h3 class="text-xl font-bold text-adaptive">إرسال رسالة</h3>
<button onclick="closeContactModal()" class="text-adaptive-secondary hover:text-adaptive">
<span class="text-2xl">×</span>
</button>
</div>
<form id="contactForm" class="space-y-4">
<div>
<label class="block text-sm font-medium text-adaptive-secondary mb-2">الاسم</label>
<input type="text" name="name" required class="w-full p-3 border rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 text-adaptive text-base">
</div>
<div>
<label class="block text-sm font-medium text-adaptive-secondary mb-2">رقم الهاتف</label>
<input type="tel" name="phone" required class="w-full p-3 border rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 text-adaptive text-base">
</div>
<div>
<label class="block text-sm font-medium text-adaptive-secondary mb-2">الرسالة</label>
<textarea name="message" required rows="4" class="w-full p-3 border rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 text-adaptive text-base"></textarea>
</div>
<button type="submit" class="w-full bg-accent hover:bg-green-600 text-white py-3 rounded-lg font-medium transition-all duration-300">
إرسال الرسالة
</button>
</form>
</div>
</div>
</div>
</div>

<!-- Footer -->
<footer class="bg-oman-blue dark:bg-gray-800 text-white py-8 mt-16">
<div class="container mx-auto px-4">
<div class="grid grid-cols-1 md:grid-cols-3 gap-8">
<div>
<h3 class="text-xl font-bold mb-4" id="footer-company-name">المصداقية لتأجير الوحدات</h3>
<p class="text-gray-300" id="footer-description">نوفر أفضل الوحدات السكنية للإيجار في صلالة وضواحيها بأسعار مناسبة وخدمة متميزة.</p>
</div>
<div>
<h3 class="text-xl font-bold mb-4">التواصل</h3>
<div class="space-y-2">
<p id="footer-whatsapp">📱 واتساب: +968 9876 5432</p>
<p id="footer-phone">📞 هاتف: +968 2345 6789</p>
<p id="footer-email">✉️ البريد: info@almosdaqiya.om</p>
<p id="footer-address">📍 العنوان: صلالة، سلطنة عمان</p>
</div>
</div>
<div>
<h3 class="text-xl font-bold mb-4">روابط سريعة</h3>
<div class="space-y-2">
<a href="#" class="block hover:text-oman-light transition-colors">سياسة الخصوصية</a>
<a href="#" class="block hover:text-oman-light transition-colors">شروط الاستخدام</a>
<a href="#" class="block hover:text-oman-light transition-colors">من نحن</a>
</div>
</div>
</div>
<div class="border-t border-gray-600 mt-8 pt-8 text-center">
<p>&copy; 2024 المصداقية لتأجير الوحدات السكنية. جميع الحقوق محفوظة.</p>
<p class="text-sm text-gray-400 mt-2">تم التطوير بـ ❤️ في صلالة، عمان |
<a href="https://github.com/tammam00/almesdaqiah-website" class="hover:text-white transition-colors">GitHub</a>
</p>
</div>
</div>
</footer>

<script>
// ===== إعدادات التطبيق =====
const APP_CONFIG = {
MAX_IMAGES: 10,
MAX_FILE_SIZE: 5 * 1024 * 1024, // 5MB
CALENDAR_START: { month: 5, day: 1 }, // يونيو 1
CALENDAR_END: { month: 8, day: 1 }, // سبتمبر 1
ADMIN_CREDENTIALS: { username: 'AbuSalim', password: '19802002' },

// إعدادات GitHub Repository المنفصل للبيانات
GITHUB_CONFIG: {
owner: 'tammam00', // اسم المستخدم في GitHub
repo: 'almesdaqiah-data', // اسم مستودع البيانات
branch: 'main', // الفرع الأساسي
dataFile: 'data.json', // اسم ملف البيانات
token: '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' // التوكن الخاص بك
},

// إعدادات التزامن العامة
SYNC_CONFIG: {
SYNC_INTERVAL: 10, // تردد التحقق (بالثواني)
MAX_RETRIES: 3, // الحد الأقصى للمحاولات
DATA_SIGNATURE: 'ALMOSDAQIYA_RENTAL_DATA_V2'
}
};

// أسماء الأيام والشهور العربية
const ARABIC_DAYS = ['الأحد', 'الاثنين', 'الثلاثاء', 'الأربعاء', 'الخميس', 'الجمعة', 'السبت'];
const ARABIC_MONTHS = [
'يناير', 'فبراير', 'مارس', 'أبريل', 'مايو', 'يونيو',
'يوليو', 'أغسطس', 'سبتمبر', 'أكتوبر', 'نوفمبر', 'ديسمبر'
];

// ===== نظام التزامن مع GitHub Repository =====
class GitHubRepoSync {
constructor() {
// استخدام الإعدادات من APP_CONFIG
this.owner = APP_CONFIG.GITHUB_CONFIG.owner;
this.repo = APP_CONFIG.GITHUB_CONFIG.repo;
this.branch = APP_CONFIG.GITHUB_CONFIG.branch;
this.dataFile = APP_CONFIG.GITHUB_CONFIG.dataFile;

// بناء الروابط المطلوبة
this.baseUrl = `https://api.github.com/repos/${this.owner}/${this.repo}`;
this.rawUrl = `https://raw.githubusercontent.com/${this.owner}/${this.repo}/${this.branch}/${this.dataFile}`;

console.log('🔧 تهيئة نظام GitHub Repository:');
console.log('📁 Repository:', `${this.owner}/${this.repo}`);
console.log('🔗 Raw URL:', this.rawUrl);
}

// 📖 قراءة البيانات (عامة، بدون token)
async fetchData() {
try {
console.log('📡 جاري جلب البيانات من GitHub Repository...');

// إضافة timestamp لمنع التخزين المؤقت
const url = this.rawUrl + '?t=' + Date.now();
const response = await fetch(url, {
method: 'GET',
headers: {
'Accept': 'application/json',
'Cache-Control': 'no-cache'
}
});

if (response.ok) {
const data = await response.json();
console.log('✅ تم جلب البيانات بنجاح:', {
version: data.version || 'غير محدد',
lastUpdate: data.lastUpdate || 'غير محدد',
unitsCount: data.units?.length || 0,
messagesCount: data.messages?.length || 0
});
return data;
} else {
throw new Error(`HTTP ${response.status}: ${response.statusText}`);
}
} catch (error) {
console.warn('❌ فشل في جلب البيانات من GitHub Repository:', error.message);
return null;
}
}

// 💾 حفظ البيانات (يحتاج token للإدارة)
async saveData(data, token) {
if (!token) {
console.warn('🔑 يحتاج Personal Access Token للحفظ في GitHub');
return false;
}

try {
console.log('💾 جاري حفظ البيانات في GitHub Repository...');

// 1️⃣ الحصول على SHA الحالي للملف (مطلوب للتحديث)
console.log('🔍 جاري البحث عن SHA الملف الحالي...');
const sha = await this.getFileSHA(token);

// إعداد طلب التحديث
const requestBody = {
message: `تحديث البيانات - ${new Date().toLocaleString('ar-SA')}`,
content: '',
branch: this.branch,
committer: {
name: 'AlMosdaqiya Admin',
email: 'admin@almosdaqiya.local'
}
};

// إضافة SHA فقط إذا كان الملف موجوداً
if (sha && sha !== 'CREATE_NEW_FILE') {
requestBody.sha = sha;
console.log('✅ تم العثور على SHA:', sha.substring(0, 8) + '...');
} else {
console.log('📄 سيتم إنشاء ملف جديد');
}

// 2️⃣ إعداد البيانات المحدثة
const updatedData = {
...data,
signature: APP_CONFIG.SYNC_CONFIG.DATA_SIGNATURE,
lastUpdate: new Date().toISOString(),
version: this.incrementVersion(data.version),
updatedBy: 'admin_' + Date.now(),
metadata: {
...data.metadata,
lastModified: new Date().toISOString(),
source: 'GitHub Repository API'
}
};

// 3️⃣ تحويل البيانات إلى JSON منسق
const jsonContent = JSON.stringify(updatedData, null, 2);

// 4️⃣ تحويل إلى Base64 (مطلوب لـ GitHub API) مع معالجة UTF-8
const base64Content = btoa(unescape(encodeURIComponent(jsonContent)));

// 5️⃣ إرسال التحديث إلى GitHub
console.log('📤 جاري رفع التحديث إلى GitHub...');

// إعداد البيانات النهائية للإرسال
requestBody.content = base64Content;

const response = await fetch(`${this.baseUrl}/contents/${this.dataFile}`, {
method: 'PUT',
headers: {
'Authorization': `Bearer ${token}`,
'Accept': 'application/vnd.github.v3+json',
'Content-Type': 'application/json',
'User-Agent': 'AlMosdaqiya-Rental-App/1.0'
},
body: JSON.stringify(requestBody)
});

if (response.ok) {
const result = await response.json();
console.log('✅ تم حفظ البيانات في GitHub بنجاح!');
console.log('📊 معلومات الحفظ:', {
sha: result.content.sha.substring(0, 8) + '...',
size: result.content.size + ' bytes',
downloadUrl: result.content.download_url
});
return true;
} else {
const errorData = await response.json();
throw new Error(`GitHub API Error (${response.status}): ${errorData.message}`);
}

} catch (error) {
console.error('❌ فشل في حفظ البيانات في GitHub Repository:', error.message);
return false;
}
}

// 🔍 الحصول على SHA الحالي للملف
async getFileSHA(token) {
try {
const response = await fetch(`${this.baseUrl}/contents/${this.dataFile}`, {
method: 'GET',
headers: {
'Authorization': `Bearer ${token}`,
'Accept': 'application/vnd.github.v3+json'
}
});

if (response.ok) {
const fileData = await response.json();
return fileData.sha;
} else if (response.status === 404) {
console.log('📄 الملف غير موجود، سيتم إنشاؤه جديد');
return 'CREATE_NEW_FILE'; // علامة خاصة لإنشاء ملف جديد
} else {
console.warn('⚠️ خطأ في جلب معلومات الملف:', response.status, response.statusText);
return null;
}
} catch (error) {
console.warn('❌ خطأ في جلب SHA الملف:', error.message);
return null;
}
}

// 📈 زيادة رقم الإصدار
incrementVersion(currentVersion) {
if (!currentVersion) return '1.0';
const version = parseFloat(currentVersion);
return (version + 0.1).toFixed(1);
}

// 🔍 التحقق من صحة الـ Token
async validateToken(token) {
try {
const response = await fetch(`${this.baseUrl}`, {
headers: {
'Authorization': `Bearer ${token}`,
'Accept': 'application/vnd.github.v3+json'
}
});
return response.ok;
} catch (error) {
return false;
}
}
}

// ===== متغيرات التطبيق =====
let syncSystem;
let siteSettings = {};
let units = [];
let messages = [];
let currentUser = null;
let selectedDates = [];
let currentUnit = null;
let currentImages = [];
let currentAvailability = {};

// تهيئة التطبيق
async function initApp() {
console.log('🚀 بدء تهيئة موقع المصداقية...');

try {
// تهيئة نظام التزامن المركزي
syncSystem = new GitHubRepoSync();

// تحميل البيانات من GitHub
const data = await syncSystem.fetchData();

if (data && data.signature === APP_CONFIG.SYNC_CONFIG.DATA_SIGNATURE) {
// تطبيق البيانات المحملة
if (data.units) units = data.units;
if (data.siteSettings) siteSettings = data.siteSettings;
if (data.messages) messages = data.messages;

console.log('✅ تم تحميل البيانات من GitHub بنجاح');
} else {
console.warn('⚠️ فشل في تحميل البيانات، استخدام البيانات الافتراضية');
loadDefaultData();
}

// تهيئة العناصر
setupEventListeners();
initDarkMode();
updateFooter();
loadUnits();

console.log('✅ تم تهيئة الموقع بنجاح');

} catch (error) {
console.error('❌ خطأ في تهيئة التطبيق:', error);
loadDefaultData();
setupEventListeners();
initDarkMode();
loadUnits();
} finally {
// إخفاء شاشة التحميل
document.getElementById('loadingSpinner').classList.add('hidden');
}
}

// تحميل البيانات الافتراضية
function loadDefaultData() {
units = [
{
id: 1,
name: "شقة الخليج الراقية",
type: "شقة",
location: "صلالة الجديدة",
description: "شقة مفروشة بالكامل مع إطلالة رائعة على البحر، تحتوي على غرفتين وصالة ومطبخ مجهز",
images: [
"https://picsum.photos/400/300?random=1",
"https://picsum.photos/400/300?random=2",
"https://picsum.photos/400/300?random=3"
],
availability: generateSampleAvailability(),
contact: { whatsapp: "+96812345678", phone: "+96812345678" }
},
{
id: 2,
name: "غرفة المرجان الهادئة",
type: "غرفة",
location: "صلالة الوسطى",
description: "غرفة نظيفة ومريحة مع حمام خاص، مناسبة للأفراد أو الأزواج",
images: [
"https://picsum.photos/400/300?random=4",
"https://picsum.photos/400/300?random=5"
],
availability: generateSampleAvailability(),
contact: { whatsapp: "+96812345679", phone: "+96812345679" }
}
];

siteSettings = {
phone: '+968 2345 6789',
whatsapp: '+968 9876 5432',
email: 'info@almosdaqiya.om',
address: 'صلالة، سلطنة عمان',
companyName: 'المصداقية لتأجير الوحدات السكنية',
description: 'نوفر أفضل الوحدات السكنية للإيجار في صلالة وضواحيها بأسعار مناسبة وخدمة متميزة.'
};

messages = [];
}

// توليد بيانات التوفر التجريبية
function generateSampleAvailability() {
const availability = {};
const dates = generateDateRange();

dates.forEach(dateStr => {
const isAvailable = Math.random() > 0.3; // 70% متاح
const basePrice = 40 + Math.floor(Math.random() * 60); // 40-100 ريال

availability[dateStr] = {
available: isAvailable,
price: basePrice
};
});

return availability;
}

// توليد نطاق التواريخ من يونيو إلى سبتمبر
function generateDateRange() {
const dates = [];
const currentYear = new Date().getFullYear();
const today = new Date();
// تحديد السنة الصحيحة (إذا كنا في يناير-مايو، استخدم السنة الحالية، وإلا العام القادم)
const year = today.getMonth() < 5 ? currentYear : currentYear;

const startDate = new Date(year, APP_CONFIG.CALENDAR_START.month, APP_CONFIG.CALENDAR_START.day);
// إصلاح: نهاية سبتمبر بدلاً من بداية سبتمبر
const endDate = new Date(year, APP_CONFIG.CALENDAR_END.month, 30); // 30 سبتمبر

for (let date = new Date(startDate); date <= endDate; date.setDate(date.getDate() + 1)) {
dates.push(date.toISOString().split('T')[0]);
}

return dates;
}

// إعداد مستمعي الأحداث
function setupEventListeners() {
document.getElementById('typeFilter').addEventListener('change', filterUnits);
document.getElementById('priceFilter').addEventListener('change', filterUnits);
document.getElementById('locationFilter').addEventListener('change', filterUnits);
document.getElementById('searchInput').addEventListener('input', filterUnits);
document.getElementById('contactForm').addEventListener('submit', handleContactSubmit);
}

// الوضع الليلي
function initDarkMode() {
if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
document.documentElement.classList.add('dark');
}
updateThemeIcon();

window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
document.documentElement.classList.toggle('dark', event.matches);
updateThemeIcon();
});
}

function toggleDarkMode() {
document.documentElement.classList.toggle('dark');
updateThemeIcon();
}

function updateThemeIcon() {
const icon = document.getElementById('theme-icon');
const isDark = document.documentElement.classList.contains('dark');
icon.textContent = isDark ? '☀️' : '🌙';
}

// تحديث تذييل الموقع
function updateFooter() {
document.getElementById('footer-company-name').textContent = siteSettings.companyName || 'المصداقية لتأجير الوحدات';
document.getElementById('footer-description').textContent = siteSettings.description || 'نوفر أفضل الوحدات السكنية للإيجار';
document.getElementById('footer-whatsapp').textContent = `📱 واتساب: ${siteSettings.whatsapp || '+968 9876 5432'}`;
document.getElementById('footer-phone').textContent = `📞 هاتف: ${siteSettings.phone || '+968 2345 6789'}`;
document.getElementById('footer-email').textContent = `✉️ البريد: ${siteSettings.email || 'info@almosdaqiya.om'}`;
document.getElementById('footer-address').textContent = `📍 العنوان: ${siteSettings.address || 'صلالة، سلطنة عمان'}`;
}

// تحميل وعرض الوحدات
function loadUnits() {
const grid = document.getElementById('unitsGrid');
grid.innerHTML = '';

if (!units || units.length === 0) {
grid.innerHTML = `
<div class="col-span-full text-center py-12">
<div class="text-6xl mb-4">🏠</div>
<h3 class="text-xl font-bold text-adaptive mb-2">جاري تحميل الوحدات...</h3>
<p class="text-adaptive-secondary">إذا لم تظهر الوحدات، تأكد من اتصالك بالإنترنت</p>
</div>
`;
return;
}

units.forEach(unit => {
const unitCard = createUnitCard(unit);
grid.appendChild(unitCard);
});

// تهيئة المنزلقات
setTimeout(initSwipers, 100);
}

// إنشاء بطاقة الوحدة
function createUnitCard(unit) {
const card = document.createElement('div');
card.className = 'neumorphic rounded-2xl overflow-hidden fade-in hover:shadow-2xl transition-all duration-300 cursor-pointer';
// الحصول على الأسعار الفعلية للأيام القادمة
const upcomingPrices = getUpcomingPrices(unit, 5);
const priceRange = getUnitPriceRange(unit);

card.innerHTML = `
<div class="relative">
<div class="swiper" id="swiper-${unit.id}">
<div class="swiper-wrapper">
${unit.images.map(img => `
<div class="swiper-slide">
<img src="${img}" alt="${unit.name}" class="w-full h-48 object-cover">
</div>
`).join('')}
</div>
<div class="swiper-pagination"></div>
<div class="swiper-button-next"></div>
<div class="swiper-button-prev"></div>
</div>
<div class="absolute top-2 right-2 bg-oman-blue text-white px-2 py-1 rounded-lg text-sm font-bold">
${unit.type}
</div>
<div class="absolute top-2 left-2 bg-accent text-white px-2 py-1 rounded-lg text-sm font-bold">
من ${priceRange.min} ر.ع
</div>
</div>

<div class="p-4">
<h3 class="text-lg font-bold text-adaptive mb-2">${unit.name}</h3>
<p class="text-sm text-adaptive-secondary mb-2 flex items-center">
<span class="ml-1">📍</span> ${unit.location}
</p>
<p class="text-sm text-adaptive mb-4 line-clamp-2">${unit.description}</p>

<div class="mb-4">
<h4 class="text-sm font-medium text-adaptive-secondary mb-2">الأيام المتاحة القادمة</h4>
<div class="grid grid-cols-5 gap-1">
${upcomingPrices.filter(day => day.available).slice(0, 5).map(day => {
const dateObj = new Date(day.date);
const dayName = ARABIC_DAYS[dateObj.getDay()];
return `
<div class="text-center p-1 bg-accent text-white rounded text-xs">
<div class="font-bold">${dayName.substring(0, 3)}</div>
<div>${dateObj.getDate()}</div>
<div>${day.price}ر.ع</div>
</div>
`;
}).join('')}
</div>
</div>

<div class="flex justify-between items-center">
<div class="text-lg font-bold text-oman-blue dark:text-oman-light">
${priceRange.min === priceRange.max
? `${priceRange.min} ر.ع/ليلة`
: `${priceRange.min} - ${priceRange.max} ر.ع/ليلة`}
</div>
<div class="flex space-x-2 space-x-reverse">
<button onclick="showUnitDetails(${unit.id})" class="px-3 py-1 bg-oman-blue hover:bg-oman-light text-white rounded-lg text-sm transition-all">
التفاصيل
</button>
<a href="https://wa.me/${unit.contact.whatsapp}?text=${encodeURIComponent('مرحباً، أود الاستفسار عن ' + unit.name)}"
target="_blank"
class="px-3 py-1 bg-accent hover:bg-green-600 text-white rounded-lg text-sm transition-all inline-block text-center">
تواصل
</a>
</div>
</div>
</div>
`;

return card;
}

// تهيئة منزلقات الصور
function initSwipers() {
units.forEach(unit => {
try {
new Swiper(`#swiper-${unit.id}`, {
pagination: { el: `#swiper-${unit.id} .swiper-pagination`, clickable: true },
navigation: {
nextEl: `#swiper-${unit.id} .swiper-button-next`,
prevEl: `#swiper-${unit.id} .swiper-button-prev`
},
loop: unit.images.length > 1,
autoplay: {
delay: 3000,
disableOnInteraction: false,
}
});
} catch (error) {
console.warn('خطأ في تهيئة Swiper للوحدة', unit.id, error);
}
});
}

// حساب متوسط سعر الوحدة
function getUnitAveragePrice(unit) {
const prices = Object.values(unit.availability)
.filter(info => info.available)
.map(info => info.price);
return prices.length > 0 ? Math.round(prices.reduce((a, b) => a + b, 0) / prices.length) : 50;
}

// الحصول على نطاق الأسعار للوحدة
function getUnitPriceRange(unit) {
const prices = Object.values(unit.availability)
.filter(info => info.available)
.map(info => info.price);

if (prices.length === 0) return { min: 50, max: 50 };

const min = Math.min(...prices);
const max = Math.max(...prices);

return { min, max };
}

// الحصول على الأسعار الفعلية للأيام القادمة
function getUpcomingPrices(unit, count = 5) {
const today = new Date();
const dates = generateDateRange();
const upcomingDates = dates.filter(dateStr => {
const date = new Date(dateStr);
return date >= today;
}).slice(0, count);

return upcomingDates.map(dateStr => {
const dayInfo = unit.availability[dateStr];
return {
date: dateStr,
available: dayInfo ? dayInfo.available : true,
price: dayInfo ? dayInfo.price : 50
};
});
}

// تصفية الوحدات
function filterUnits() {
const filters = {
type: document.getElementById('typeFilter').value,
price: document.getElementById('priceFilter').value,
location: document.getElementById('locationFilter').value,
search: document.getElementById('searchInput').value.toLowerCase()
};

const filteredUnits = units.filter(unit => {
if (filters.type && unit.type !== filters.type) return false;
if (filters.location && unit.location !== filters.location) return false;
if (filters.search) {
const searchText = (unit.name + ' ' + unit.description).toLowerCase();
if (!searchText.includes(filters.search)) return false;
}
if (filters.price) {
const avgPrice = getUnitAveragePrice(unit);
const [min, max] = filters.price.split('-').map(p => p.replace('+', ''));
if (max && (avgPrice < parseInt(min) || avgPrice > parseInt(max))) return false;
if (!max && avgPrice < parseInt(min)) return false;
}
return true;
});

displayFilteredUnits(filteredUnits);
}

// عرض الوحدات المصفاة
function displayFilteredUnits(filteredUnits) {
const grid = document.getElementById('unitsGrid');

if (filteredUnits.length === 0) {
grid.innerHTML = `
<div class="col-span-full text-center py-12">
<div class="text-6xl mb-4">🔍</div>
<h3 class="text-xl font-bold text-adaptive mb-2">لا توجد وحدات متاحة</h3>
<p class="text-adaptive-secondary">جرب تغيير معايير البحث</p>
</div>
`;
return;
}

grid.innerHTML = '';
filteredUnits.forEach(unit => {
const unitCard = createUnitCard(unit);
grid.appendChild(unitCard);
});

setTimeout(initSwipers, 100);
}

// عرض تفاصيل الوحدة
function showUnitDetails(unitId) {
const unit = units.find(u => u.id === unitId);
if (!unit) return;

currentUnit = unit;
showUnitModal(unit);
}

// إدارة تسجيل دخول الإدارة
function showAdminLogin() {
showLoginModal();
}

// عرض نافذة تسجيل الدخول
function showLoginModal() {
const modal = document.getElementById('adminPanel');
modal.innerHTML = `
<div class="modal-container flex items-center justify-center">
<div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl w-full max-w-md mx-4">
<div class="p-6">
<div class="flex justify-between items-center mb-6">
<h3 class="text-xl font-bold text-adaptive">تسجيل دخول الإدارة</h3>
<button onclick="closeModal('adminPanel')" class="text-adaptive-secondary hover:text-adaptive">
<span class="text-2xl">×</span>
</button>
</div>
<form id="adminLoginForm" class="space-y-4">
<div>
<label class="block text-sm font-medium text-adaptive-secondary mb-2">اسم المستخدم</label>
<input type="text" id="adminUsername" required class="w-full p-3 border rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 text-adaptive text-base">
</div>
<div>
<label class="block text-sm font-medium text-adaptive-secondary mb-2">كلمة المرور</label>
<input type="password" id="adminPassword" required class="w-full p-3 border rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 text-adaptive text-base">
</div>
<button type="submit" class="w-full bg-oman-blue hover:bg-oman-light text-white py-3 rounded-lg font-medium transition-all duration-300">
تسجيل الدخول
</button>
</form>
</div>
</div>
</div>
`;

modal.classList.remove('hidden');

// إضافة مستمع للنموذج
document.getElementById('adminLoginForm').addEventListener('submit', handleAdminLogin);
}

// معالجة تسجيل دخول الإدارة
function handleAdminLogin(event) {
event.preventDefault();

const username = document.getElementById('adminUsername').value;
const password = document.getElementById('adminPassword').value;

if (username === APP_CONFIG.ADMIN_CREDENTIALS.username && password === APP_CONFIG.ADMIN_CREDENTIALS.password) {
currentUser = { username, role: 'admin' };
showAdminDashboard();
} else {
showNotification('بيانات تسجيل الدخول غير صحيحة', 'error');
}
}

// معالجة إرسال نموذج التواصل
function handleContactSubmit(event) {
event.preventDefault();

const formData = new FormData(event.target);
const messageData = {
id: Date.now(),
name: formData.get('name') || event.target.elements[0].value,
phone: formData.get('phone') || event.target.elements[1].value,
message: formData.get('message') || event.target.elements[2].value,
date: new Date().toISOString(),
status: 'new'
};

// إضافة الرسالة محلياً
messages.push(messageData);

// عرض رسالة نجاح
showNotification('تم إرسال رسالتك بنجاح! سنتواصل معك قريباً', 'success');
closeContactModal();

// محاولة حفظ في GitHub (إذا كان متاحاً)
if (currentUser && currentUser.role === 'admin') {
saveAllData();
}
}

// إغلاق نافذة التواصل
function closeContactModal() {
document.getElementById('contactModal').classList.add('hidden');
document.getElementById('contactForm').reset();
}

// تهيئة التطبيق عند تحميل الصفحة
document.addEventListener('DOMContentLoaded', initApp);

// معالج للنقر خارج النوافذ المنبثقة
document.addEventListener('click', function(event) {
const modals = ['adminPanel', 'unitModal', 'contactModal'];
modals.forEach(modalId => {
const modal = document.getElementById(modalId);
if (event.target === modal) {
modal.classList.add('hidden');
}
});
});

// ===== الوظائف المفقودة =====

// عرض نافذة تفاصيل الوحدة
function showUnitModal(unit) {
const modal = document.getElementById('unitModal');
const upcomingPrices = getUpcomingPrices(unit, 10);
const priceRange = getUnitPriceRange(unit);

modal.innerHTML = `
<div class="modal-container flex items-center justify-center">
<div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl w-full max-w-4xl mx-4">
<div class="p-6">
<div class="flex justify-between items-center mb-6">
<h3 class="text-2xl font-bold text-adaptive">${unit.name}</h3>
<button onclick="closeModal('unitModal')" class="text-adaptive-secondary hover:text-adaptive">
<span class="text-2xl">×</span>
</button>
</div>

<!-- معرض الصور -->
<div class="mb-6">
<div class="swiper" id="unit-modal-swiper">
<div class="swiper-wrapper">
${unit.images.map(img => `
<div class="swiper-slide">
<img src="${img}" alt="${unit.name}" class="w-full h-64 object-cover rounded-lg">
</div>
`).join('')}
</div>
<div class="swiper-pagination"></div>
<div class="swiper-button-next"></div>
<div class="swiper-button-prev"></div>
</div>
</div>

<!-- تفاصيل الوحدة -->
<div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
<div>
<h4 class="text-lg font-bold text-adaptive mb-3">تفاصيل الوحدة</h4>
<div class="space-y-3">
<div class="flex items-center space-x-3 space-x-reverse">
<span class="text-2xl">🏠</span>
<div>
<p class="font-medium text-adaptive">${unit.type}</p>
<p class="text-sm text-adaptive-secondary">نوع الوحدة</p>
</div>
</div>
<div class="flex items-center space-x-3 space-x-reverse">
<span class="text-2xl">📍</span>
<div>
<p class="font-medium text-adaptive">${unit.location}</p>
<p class="text-sm text-adaptive-secondary">الموقع</p>
</div>
</div>
<div class="flex items-center space-x-3 space-x-reverse">
<span class="text-2xl">💰</span>
<div>
<p class="font-medium text-adaptive">${priceRange.min} - ${priceRange.max} ر.ع</p>
<p class="text-sm text-adaptive-secondary">السعر / ليلة</p>
</div>
</div>
</div>
</div>

<div>
<h4 class="text-lg font-bold text-adaptive mb-3">التوفر القادم</h4>
<div class="space-y-2 max-h-48 overflow-y-auto">
${upcomingPrices.filter(day => day.available).slice(0, 10).map(day => {
const dateObj = new Date(day.date);
const dayName = ARABIC_DAYS[dateObj.getDay()];
return `
<div class="flex justify-between items-center p-2 bg-gray-50 dark:bg-gray-700 rounded">
<span class="text-adaptive">${dayName} ${dateObj.getDate()}/${dateObj.getMonth() + 1}</span>
<span class="font-bold text-accent">${day.price} ر.ع</span>
</div>
`;
}).join('')}
</div>
</div>
</div>

<!-- الوصف -->
<div class="mb-6">
<h4 class="text-lg font-bold text-adaptive mb-3">الوصف</h4>
<p class="text-adaptive-secondary leading-relaxed">${unit.description}</p>
</div>

<!-- أزرار التواصل -->
<div class="flex flex-col sm:flex-row gap-4">
<a href="https://wa.me/${unit.contact.whatsapp}?text=${encodeURIComponent('مرحباً، أود حجز ' + unit.name)}"
target="_blank"
class="flex-1 bg-accent hover:bg-green-600 text-white py-3 px-6 rounded-lg font-medium transition-all text-center">
📱 تواصل عبر واتساب
</a>
<a href="tel:${unit.contact.phone}"
class="flex-1 bg-oman-blue hover:bg-oman-light text-white py-3 px-6 rounded-lg font-medium transition-all text-center">
📞 اتصل الآن
</a>
<button onclick="showContactModal()"
class="flex-1 bg-gray-600 hover:bg-gray-700 text-white py-3 px-6 rounded-lg font-medium transition-all">
✉️ إرسال رسالة
</button>
</div>
</div>
</div>
</div>
`;

modal.classList.remove('hidden');
// تهيئة Swiper للنافذة المنبثقة
setTimeout(() => {
new Swiper('#unit-modal-swiper', {
pagination: { el: '#unit-modal-swiper .swiper-pagination', clickable: true },
navigation: {
nextEl: '#unit-modal-swiper .swiper-button-next',
prevEl: '#unit-modal-swiper .swiper-button-prev'
},
loop: unit.images.length > 1,
autoplay: { delay: 4000, disableOnInteraction: false }
});
}, 100);
}

// عرض نافذة التواصل
function showContactModal() {
document.getElementById('contactModal').classList.remove('hidden');
}

// إغلاق النوافذ المنبثقة
function closeModal(modalId) {
document.getElementById(modalId).classList.add('hidden');
}
// عرض لوحة الإدارة
function showAdminDashboard() {
const modal = document.getElementById('adminPanel');
modal.innerHTML = `
<div class="modal-container">
<div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl w-full max-w-6xl mx-4">
<div class="p-6">
<div class="flex justify-between items-center mb-6">
<h3 class="text-2xl font-bold text-adaptive">لوحة إدارة المصداقية</h3>
<button onclick="logout()" class="px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg transition-all">
تسجيل خروج
</button>
</div>

<!-- إحصائيات سريعة -->
<div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
<div class="bg-gradient-to-r from-blue-500 to-blue-600 text-white p-4 rounded-lg">
<div class="text-2xl font-bold">${units.length}</div>
<div class="text-sm opacity-90">إجمالي الوحدات</div>
</div>
<div class="bg-gradient-to-r from-green-500 to-green-600 text-white p-4 rounded-lg">
<div class="text-2xl font-bold">${units.filter(u => Object.values(u.availability).some(a => a.available)).length}</div>
<div class="text-sm opacity-90">الوحدات المتاحة</div>
</div>
<div class="bg-gradient-to-r from-purple-500 to-purple-600 text-white p-4 rounded-lg">
<div class="text-2xl font-bold">${messages.length}</div>
<div class="text-sm opacity-90">الرسائل الجديدة</div>
</div>
<div class="bg-gradient-to-r from-orange-500 to-orange-600 text-white p-4 rounded-lg">
<div class="text-2xl font-bold">${Math.round(units.reduce((sum, unit) => sum + getUnitAveragePrice(unit), 0) / units.length) || 0}</div>
<div class="text-sm opacity-90">متوسط السعر (ر.ع)</div>
</div>
</div>

<!-- علامات التبويب -->
<div class="border-b border-gray-200 dark:border-gray-700 mb-6">
<nav class="flex space-x-8 space-x-reverse">
<button onclick="showAdminTab('units')" class="admin-tab-btn py-2 px-1 border-b-2 border-oman-blue text-oman-blue font-medium">
إدارة الوحدات
</button>
<button onclick="showAdminTab('messages')" class="admin-tab-btn py-2 px-1 border-b-2 border-transparent text-adaptive-secondary hover:text-adaptive">
الرسائل (${messages.filter(m => m.status === 'new').length})
</button>
<button onclick="showAdminTab('settings')" class="admin-tab-btn py-2 px-1 border-b-2 border-transparent text-adaptive-secondary hover:text-adaptive">
إعدادات الموقع
</button>
</nav>
</div>

<!-- محتوى علامات التبويب -->
<div id="admin-tab-content">
${getUnitsAdminContent()}
</div>
</div>
</div>
</div>
`;

modal.classList.remove('hidden');
}
// الحصول على محتوى إدارة الوحدات
function getUnitsAdminContent() {
return `
<div class="space-y-6">
<div class="flex justify-between items-center">
<h4 class="text-lg font-bold text-adaptive">الوحدات السكنية</h4>
<button onclick="showAddUnitForm()" class="bg-accent hover:bg-green-600 text-white px-4 py-2 rounded-lg transition-all">
+ إضافة وحدة جديدة
</button>
</div>

<div class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-4">
${units.map(unit => `
<div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4">
<div class="flex justify-between items-start mb-3">
<h5 class="font-bold text-adaptive">${unit.name}</h5>
<div class="flex space-x-2 space-x-reverse">
<button onclick="editUnit(${unit.id})" class="text-blue-500 hover:text-blue-700">
✏️
</button>
<button onclick="deleteUnit(${unit.id})" class="text-red-500 hover:text-red-700">
🗑️
</button>
</div>
</div>
<p class="text-sm text-adaptive-secondary mb-2">${unit.type} - ${unit.location}</p>
<p class="text-sm text-adaptive mb-3">${unit.description.substring(0, 100)}...</p>
<div class="text-sm">
<span class="text-accent font-medium">${getUnitPriceRange(unit).min} - ${getUnitPriceRange(unit).max} ر.ع/ليلة</span>
</div>
</div>
`).join('')}
</div>
</div>
`;
}
// عرض علامة تبويب في الإدارة
function showAdminTab(tab) {
// تحديث أزرار التبويب
document.querySelectorAll('.admin-tab-btn').forEach(btn => {
btn.className = 'admin-tab-btn py-2 px-1 border-b-2 border-transparent text-adaptive-secondary hover:text-adaptive';
});
event.target.className = 'admin-tab-btn py-2 px-1 border-b-2 border-oman-blue text-oman-blue font-medium';

// تحديث المحتوى
const content = document.getElementById('admin-tab-content');
switch(tab) {
case 'units':
content.innerHTML = getUnitsAdminContent();
break;
case 'messages':
content.innerHTML = getMessagesAdminContent();
break;
case 'settings':
content.innerHTML = getSettingsAdminContent();
break;
}
}
// محتوى إدارة الرسائل
function getMessagesAdminContent() {
return `
<div class="space-y-4">
<h4 class="text-lg font-bold text-adaptive">الرسائل الواردة</h4>
${messages.length === 0 ?
'<p class="text-adaptive-secondary">لا توجد رسائل جديدة</p>' :
messages.map(msg => `
<div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4 ${msg.status === 'new' ? 'bg-blue-50 dark:bg-blue-900/20' : ''}">
<div class="flex justify-between items-start mb-2">
<h5 class="font-bold text-adaptive">${msg.name}</h5>
<span class="text-xs text-adaptive-secondary">${new Date(msg.date).toLocaleString('ar-SA')}</span>
</div>
<p class="text-sm text-adaptive-secondary mb-2">📱 ${msg.phone}</p>
<p class="text-adaptive">${msg.message}</p>
${msg.status === 'new' ?
`<button onclick="markMessageAsRead(${msg.id})" class="mt-2 text-sm bg-oman-blue text-white px-3 py-1 rounded">تم القراءة</button>` :
'<span class="text-xs text-green-600">تم القراءة</span>'
}
</div>
`).join('')
}
</div>
`;
}

// محتوى إعدادات الموقع
function getSettingsAdminContent() {
return `
<div class="space-y-6">
<h4 class="text-lg font-bold text-adaptive">إعدادات الموقع</h4>
<form id="settingsForm" class="space-y-4">
<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
<div>
<label class="block text-sm font-medium text-adaptive-secondary mb-2">اسم الشركة</label>
<input type="text" value="${siteSettings.companyName || ''}" name="companyName" class="w-full p-3 border rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 text-adaptive text-base">
</div>
<div>
<label class="block text-sm font-medium text-adaptive-secondary mb-2">رقم الهاتف</label>
<input type="tel" value="${siteSettings.phone || ''}" name="phone" class="w-full p-3 border rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 text-adaptive text-base">
</div>
<div>
<label class="block text-sm font-medium text-adaptive-secondary mb-2">رقم واتساب</label>
<input type="tel" value="${siteSettings.whatsapp || ''}" name="whatsapp" class="w-full p-3 border rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 text-adaptive text-base">
</div>
<div>
<label class="block text-sm font-medium text-adaptive-secondary mb-2">البريد الإلكتروني</label>
<input type="email" value="${siteSettings.email || ''}" name="email" class="w-full p-3 border rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 text-adaptive text-base">
</div>
</div>
<div>
<label class="block text-sm font-medium text-adaptive-secondary mb-2">العنوان</label>
<input type="text" value="${siteSettings.address || ''}" name="address" class="w-full p-3 border rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 text-adaptive text-base">
</div>
<div>
<label class="block text-sm font-medium text-adaptive-secondary mb-2">وصف الشركة</label>
<textarea name="description" rows="3" class="w-full p-3 border rounded-lg bg-white dark:bg-gray-700 dark:border-gray-600 text-adaptive text-base">${siteSettings.description || ''}</textarea>
</div>
<button type="submit" class="bg-oman-blue hover:bg-oman-light text-white px-6 py-3 rounded-lg transition-all">
حفظ الإعدادات
</button>
</form>
</div>
`;
}
// تسجيل خروج الإدارة
function logout() {
currentUser = null;
closeModal('adminPanel');
showNotification('تم تسجيل الخروج بنجاح', 'success');
}

// عرض الإشعارات
function showNotification(message, type = 'info') {
const notification = document.createElement('div');
notification.className = `fixed top-4 right-4 z-50 px-6 py-3 rounded-lg shadow-lg text-white font-medium transform transition-all duration-300 translate-x-full`;

switch(type) {
case 'success':
notification.classList.add('bg-green-500');
break;
case 'error':
notification.classList.add('bg-red-500');
break;
case 'warning':
notification.classList.add('bg-yellow-500');
break;
default:
notification.classList.add('bg-blue-500');
}

notification.textContent = message;
document.body.appendChild(notification);

// إظهار الإشعار
setTimeout(() => {
notification.classList.remove('translate-x-full');
}, 100);

// إخفاء الإشعار
setTimeout(() => {
notification.classList.add('translate-x-full');
setTimeout(() => {
document.body.removeChild(notification);
}, 300);
}, 3000);
}
// وظائف إضافية للإدارة (مبسطة)
function markMessageAsRead(messageId) {
const message = messages.find(m => m.id === messageId);
if (message) {
message.status = 'read';
showAdminTab('messages');
showNotification('تم تحديث حالة الرسالة', 'success');
}
}

function showAddUnitForm() {
showNotification('قريباً: نموذج إضافة وحدة جديدة', 'info');
}

function editUnit(unitId) {
showNotification('قريباً: تعديل الوحدة رقم ' + unitId, 'info');
}

function deleteUnit(unitId) {
if (confirm('هل أنت متأكد من حذف هذه الوحدة؟')) {
const index = units.findIndex(u => u.id === unitId);
if (index > -1) {
units.splice(index, 1);
showAdminTab('units');
loadUnits();
showNotification('تم حذف الوحدة بنجاح', 'success');
}
}
}

// حفظ جميع البيانات
function saveAllData() {
const data = {
units,
messages,
siteSettings,
signature: APP_CONFIG.SYNC_CONFIG.DATA_SIGNATURE,
lastUpdate: new Date().toISOString(),
version: '1.0'
};

if (currentUser && syncSystem) {
syncSystem.saveData(data, APP_CONFIG.GITHUB_CONFIG.token);
}
}

console.log('🏠 تم تحميل موقع المصداقية لتأجير الوحدات السكنية');
console.log('📍 صلالة، سلطنة عمان');
console.log('🔗 GitHub Repository: https://github.com/tammam00/almesdaqiah-data');
</script>
</body>
</html>
